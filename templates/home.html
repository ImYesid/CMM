{% extends 'base.html' %}
{% load static %}
{% block content %}
<!--start page wrapper -->
<div class="page-wrapper">
  <div class="page-content">

    <div class="row">
      <div class="col-12 col-lg-12 col-xl-6">
        <div class="row row-cols-1 row-cols-lg-2">
          <div class="col">
            <div class="card radius-10 overflow-hidden">
              <div class="card-body">
                <div class="font-35 text-warning"><i class='bx bx-group'></i></div>
                <h3 class="mb-0 mt-0" id="valor_operarios">...</h3>
                <p class="mb-0">Operarios Activos</p>
              </div>
            </div>
          </div>
          <div class="col">
            <div class="card radius-10 overflow-hidden">
              <div class="card-body">
                <div class="font-35 text-primary"><i class='fab fa-pushed'></i></div>
                <h3 class="mb-0 mt-0" id="valor_activos">...</h3>
                <p class="mb-0 mt-1">Activos Operativos</p>
              </div>
            </div>
          </div>
        </div>
        <div class="row row-cols-1 row-cols-lg-2">
          <div class="col">
            <div class="card radius-10 overflow-hidden">
              <div class="card-body">
                <div class="font-35 text-danger"><i class='fas fa-exclamation-circle'></i></div>
                <h3 class="mb-0 mt-0" id="valor_incidencias">...</h3>
                <p class="mb-0 mt-1">Índice Incidencias</p>
              </div>
            </div>
          </div>
          <div class="col">
            <div class="card radius-10 overflow-hidden">
              <div class="card-body">
                <div class="font-35 text-success"><i class='fas fa-briefcase'></i></div>
                <h3 class="mb-0 mt-0" id="valor_ot">...</h3>
                <p class="mb-1">Órdenes de Trabajo</p>
              </div>
              <canvas id="ot_estado_proceso"></canvas>
            </div>
          </div>
        </div>

        <div class="card radius-10 overflow-hidden">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <div class="">
                <h3 class="mb-0">78.49%</h3>
                <p class="mb-0">Bounce Rate</p>
              </div>
              <div class="ms-auto">
                <div id="bounce-rate"></div>
              </div>
            </div>
          </div>
        </div>

      </div>

      <div class="col-12 col-lg-12 col-xl-6">
        <div class="card radius-10">
          <div class="card-body">
            <div id="submitted-application"></div>
          </div>
        </div>
        <div class="card radius-10">
          <div class="card-body">
            <div id="users-status"></div>
          </div>
        </div>
      </div>

    </div><!--end row-->

  </div>
</div>
<!--end page wrapper -->
<!--start overlay-->
<div class="overlay toggle-icon"></div>
<!--end overlay-->
<!--Start Back To Top Button-->
<a href="javaScript:;" class="back-to-top"><i class='bx bxs-up-arrow-alt'></i></a>
<!--End Back To Top Button-->
{% endblock %}

{% block script %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- <script src="{% static 'js/dashboard-human-resources.js'%}"></script> -->

		<script>
      fetch("/home/data/")
        .then(response => response.json())
        .then(data => {
          // Reemplazar valores estáticos
          document.querySelector("#valor_operarios").textContent = data.operarios_activos;
          document.querySelector("#valor_activos").textContent = data.activos_operativos;
          document.querySelector("#valor_incidencias").textContent = `${data.indice_incidencias}%`;

          // Total OT (sumando todos los estados)
          const totalOT = data.ot_estado_proceso.reduce((acc, e) => acc + e.total, 0);
          document.querySelector("#valor_ot").textContent = totalOT;

          // Gráfica de OT por estado
          const estados = data.ot_estado_proceso.map(e => e.OT_estado);
          const totales = data.ot_estado_proceso.map(e => e.total);

          new Chart(document.getElementById("ot_estado_proceso"), {
            type: 'bar',
            data: {
              labels: estados,
              datasets: [{
                label: 'Órdenes de Trabajo',
                data: totales,
                backgroundColor: ['#28a745', '#ffc107', '#dc3545', '#6c757d']
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: { display: false }
              }
            }
          });
        });
    </script>
{% endblock %}